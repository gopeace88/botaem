# 보탬e 자동화 데이터 스키마 정의

## 개요
- **작성일**: 2025-11-30
- **목적**: 자동화 구현을 위한 입력/출력 데이터 구조 정의
- **기준**: GUI 스크린샷 검증 결과 및 문서 분석

---

## 1. 공통 데이터 타입

### 1.1 기본 타입
```typescript
// 날짜 형식
type DateString = string; // "YYYY-MM-DD"
type DateTimeString = string; // "YYYY-MM-DD HH:mm:ss"

// 금액 (원 단위, 정수)
type Amount = number;

// 비율 (소수점 2자리)
type Percentage = number; // 0.00 ~ 100.00

// 상태 코드
type StatusCode = string;
```

### 1.2 코드 체계
```typescript
// 회계연도
type FiscalYear = string; // "2023", "2024"

// 보조사업코드 (연도 + 순번)
type ProjectCode = string; // "20230000020800143"

// 화면 ID
type ScreenId = string; // "94001", "93003"
```

---

## 2. 사업 기본정보 스키마

### 2.1 보조사업 정보
```typescript
interface SubsidyProject {
  // 기본 정보
  fiscalYear: FiscalYear;           // 회계연도
  projectCode: ProjectCode;          // 보조사업코드
  projectName: string;               // 보조사업명
  projectManagerId: string;          // 보조사업자ID
  projectManagerName: string;        // 보조사업자명

  // 금액 정보
  grantAmount: Amount;               // 교부금액
  executionAmount: Amount;           // 집행금액
  remainingAmount: Amount;           // 집행잔액
  interestAmount: Amount;            // 이자
  revenueAmount: Amount;             // 수익금

  // 상태 정보
  settlementStatus: SettlementStatus;      // 정산진행상태
  performanceReportStatus: ReportStatus;   // 실적보고서진행상태

  // 기간 정보
  projectStartDate: DateString;      // 사업시작일
  projectEndDate: DateString;        // 사업종료일
}

// 정산진행상태
type SettlementStatus =
  | '사업수행중'
  | '집행마감'
  | '정산검토중'
  | '정산마감';

// 실적보고서 진행상태
type ReportStatus =
  | '미처리'
  | '작성중'
  | '제출'
  | '승인';
```

### 2.2 재원별 정보
```typescript
interface FundingSource {
  sourceType: FundingType;           // 재원구분
  grantAmount: Amount;               // 교부금액(순사업비)
  netProjectRatio: Percentage;       // 순사업비 비율
  executionAmount: Amount;           // 집행금액
  executionRatio: Percentage;        // 집행 비율
  remainingAmount: Amount;           // 집행잔액
}

type FundingType =
  | '시도비'
  | '시군구비'
  | '수익자부담금'
  | '자부담';
```

---

## 3. 집행관리 스키마

### 3.1 집행등록 (전자세금계산서)
```typescript
interface TaxInvoiceExecution {
  // 사용정보
  executionPurpose: string;          // 집행목적(용도)
  evidenceType: EvidenceType;        // 증빙유형
  evidenceDocument: string;          // 증빙자료 (파일명)
  baseDocument: string;              // 기본서류
  transactionDate: DateString;       // 집행거래일

  // 거래처 정보
  vendor: VendorInfo;

  // 계좌 정보
  account: AccountInfo;

  // 금액 정보
  supplyAmount: Amount;              // 공급가액
  vatAmount: Amount;                 // 부가세액
  totalAmount: Amount;               // 집행금액

  // 비목/세목
  budgetItem: BudgetItemInfo;
}

type EvidenceType =
  | '전자세금계산서'
  | '기타증빙'
  | '신용카드';

interface VendorInfo {
  vendorType: '개인사업자' | '법인사업자' | '개인';
  vendorName: string;                // 거래처명
  businessNumber: string;            // 사업자번호
  representativeName: string;        // 대표자명
  phoneNumber?: string;              // 전화번호
  residentNumber?: string;           // 주민등록번호 (개인)
  businessType?: string;             // 업태/업종
  address: string;                   // 거래처 주소
}

interface AccountInfo {
  bankName: string;                  // 입금은행
  accountNumber: string;             // 입금계좌번호
  accountHolder: string;             // 예금주명
  depositMismatchReason?: string;    // 예금주불일치사유
  passbookImage?: string;            // 내통장표시
  receivedPassbookImage?: string;    // 받는통장표시
}
```

### 3.2 인건비 집행
```typescript
interface LaborCostExecution extends TaxInvoiceExecution {
  // 인건비 특수 필드
  withholdingTax: Amount;            // 원천징수액
  netPayment: Amount;                // 실지급액

  // 재원별 집행비율
  localFundRatio: Percentage;        // 지방비부담금 비율
  selfFundRatio: Percentage;         // 자부담금 비율
}
```

### 3.3 카드사용내역
```typescript
interface CardUsageRecord {
  cardNumber: string;                // 카드번호 (마스킹)
  transactionDateTime: DateTimeString; // 거래일시
  approvalNumber: string;            // 승인번호
  paymentAmount: Amount;             // 결제금액
  merchantName: string;              // 가맹점명
  businessType: string;              // 업종
  phoneNumber?: string;              // 전화번호
  isUsed: boolean;                   // 사용여부 (집행등록 여부)
}
```

### 3.4 비목/세목 정보
```typescript
interface BudgetItemInfo {
  subsidyItem: string;               // 보조세목(통계목)
  fundingType: FundingType;          // 재원구분
  supplyAmount: Amount;              // 공급가액
  vatAmount: Amount;                 // 부가세액
  executionAmount: Amount;           // 집행금액
  disallowedAmount?: Amount;         // 불인정금액
}
```

---

## 4. 집행이체 스키마

### 4.1 이체요청 정보
```typescript
interface TransferRequest {
  // 이체 구분
  transferType: TransferType;

  // 이체 건수/금액
  transferCount: number;             // 이체 건수
  transferAmount: Amount;            // 이체 금액

  // 이체 목록
  transferItems: TransferItem[];

  // 인증 정보
  transferPassword: string;          // 이체비밀번호
  certificateType: '공동(범용)인증서';
}

type TransferType =
  | '거래처계좌로 이체'              // 예치 → 거래처
  | '자부담계좌로 이체'              // 원천징수액 처리
  | '보조금계좌로 이체';             // 복원 처리

interface TransferItem {
  executionId: string;               // 집행등록ID
  vendorName: string;                // 거래처명
  accountNumber: string;             // 계좌번호
  transferAmount: Amount;            // 이체금액
  transferStatus: TransferStatus;    // 이체상태
  transferDate?: DateString;         // 이체일자
}

type TransferStatus =
  | '미요청'
  | '이체요청'
  | '이체완료'
  | '이체실패';
```

---

## 5. 정산관리 스키마

### 5.1 집행마감 정보
```typescript
interface ExecutionClosure {
  // 보조사업 정보
  project: SubsidyProject;

  // 재원별 실적
  fundingSources: FundingSource[];

  // 집행/교부 미처리 현황
  pendingStatus: {
    registrationCount: number;       // 집행등록건수
    requestCount: number;            // 집행요청건수
    cancellationRegCount: number;    // 집행취소등록건수
    cancellationReqCount: number;    // 집행취소요청건수
    grantInProgress: 'Y' | 'N';      // 교부진행여부
  };

  // 정산처리 진행순서
  processSteps: ProcessStep[];
}

interface ProcessStep {
  stepNumber: number;
  actor: '하위보조사업자' | '상위보조사업자';
  action: string;
  description: string;
  constraint?: string;
}
```

### 5.2 정산검토 의견
```typescript
interface SettlementReview {
  // 집행건 정보
  executionInfo: TaxInvoiceExecution;

  // 검토 의견
  reviewStatus: ReviewStatus;        // 검토진행상태
  reviewComment: string;             // 정산검토의견 (300자)

  // 불인정금액
  disallowedAmounts: BudgetItemInfo[];
}

type ReviewStatus =
  | '미검토'
  | '검토완료'
  | '보완요청'
  | '보완완료'
  | '보완불가';
```

### 5.3 정산반환 요청
```typescript
interface SettlementReturn {
  // 보조사업 정보
  project: SubsidyProject;

  // 반환 세부내역
  returnDetails: ReturnDetail[];

  // 재원별 반환금액
  fundingReturns: FundingReturn[];

  // 반환 은행계좌 정보
  returnAccount?: AccountInfo;
}

interface ReturnDetail {
  returnType: ReturnType;            // 반환대상구분
  withdrawalAccountType: WithdrawalAccountType; // 출금계좌구분
  returnAmount: Amount;              // 반환금액
  returnStatus: ReturnStatus;        // 반환진행상태
  returnDate?: DateString;           // 반환일자
  returnRequestId?: string;          // 반환입금요청ID
}

type ReturnType =
  | '사업비잔액'
  | '불인정금액'
  | '예치계좌이자'
  | '자부담계좌이자'
  | '수익금';

type WithdrawalAccountType =
  | '보조금예치계좌번호'
  | '보조사업자 계좌번호';

type ReturnStatus =
  | '미처리'
  | '반환이체완료';

interface FundingReturn {
  returnType: ReturnType;
  fundingType: FundingType;
  returnAmount: Amount;
  returnStatus: ReturnStatus;
  returnDate?: DateString;
  collectionStatus?: string;         // 징수상태
  collectionDate?: DateString;       // 징수일자
}
```

---

## 6. 실적보고서 스키마

### 6.1 실적보고서 기본정보
```typescript
interface PerformanceReport {
  // 보조사업 정보
  project: SubsidyProject;

  // 탭별 정보
  basicInfo: BasicInfo;              // 기본현황
  planVsActual: PlanVsActual;        // 계획대비실적
  projectOutcome: ProjectOutcome;    // 사업성과
  importantAssets: ImportantAsset[]; // 중요재산
  settlementReport: SettlementReport; // 정산보고서
  verificationResult?: VerificationResult; // 검증결과
  auditReport?: AuditReport;         // 감사보고서

  // 진행상태
  reportStatus: ReportStatus;
  submissionDate?: DateString;
  approvalDate?: DateString;
}

interface BasicInfo {
  projectMethod: string;             // 사업추진방법
  projectAchievement: string;        // 추진실적
}

interface PlanVsActual {
  plannedItems: PlanItem[];
  actualItems: ActualItem[];
}

interface SettlementReport {
  // 정산총괄표 (자동생성)
  summaryTable: SettlementSummary;

  // 집행내역 일자별 (자동생성)
  dailyExecutions: DailyExecution[];

  // 집행잔액 발생사유 (입력 필요)
  remainingBalanceReason: string;

  // 집행내역 전용카드 (자동생성)
  cardExecutions: CardExecution[];

  // 사업 변경내역
  projectChanges?: ProjectChange[];
}
```

---

## 7. 자동화 입력 데이터 스키마

### 7.1 전자세금계산서 일괄등록 입력
```typescript
interface TaxInvoiceBatchInput {
  // 조회 조건
  fiscalYear: FiscalYear;
  projectCode: ProjectCode;
  dateFrom: DateString;
  dateTo: DateString;

  // 비목/세목 매핑 규칙
  budgetMappingRules: BudgetMappingRule[];
}

interface BudgetMappingRule {
  vendorBusinessType: string;        // 업종 조건
  vendorNamePattern?: string;        // 거래처명 패턴
  defaultBudgetItem: string;         // 기본 비목
  defaultFundingType: FundingType;   // 기본 재원
}
```

### 7.2 카드사용내역 일괄등록 입력
```typescript
interface CardUsageBatchInput {
  // 조회 조건
  fiscalYear: FiscalYear;
  projectCode: ProjectCode;
  cardNumber?: string;               // 특정 카드 (선택)
  dateFrom: DateString;
  dateTo: DateString;

  // 필터
  onlyUnused: boolean;               // 미사용 내역만

  // 비목/세목 매핑 규칙
  budgetMappingRules: BudgetMappingRule[];
}
```

### 7.3 집행이체 일괄처리 입력
```typescript
interface TransferBatchInput {
  // 조회 조건
  fiscalYear: FiscalYear;
  projectCode: ProjectCode;

  // 이체 대상
  transferType: TransferType;

  // 인증 정보
  transferPassword: string;
  // certificatePassword: string;    // 보안상 런타임에만 입력

  // 옵션
  maxTransferCount?: number;         // 최대 이체 건수
  executeImmediately: boolean;       // 즉시 실행 여부
}
```

---

## 8. 자동화 출력 데이터 스키마

### 8.1 실행 결과
```typescript
interface AutomationResult {
  // 실행 정보
  executionId: string;
  executionType: AutomationType;
  startTime: DateTimeString;
  endTime: DateTimeString;

  // 결과 요약
  totalCount: number;
  successCount: number;
  failureCount: number;
  skippedCount: number;

  // 상세 결과
  details: AutomationDetail[];

  // 오류 정보
  errors: AutomationError[];
}

type AutomationType =
  | 'TAX_INVOICE_BATCH'
  | 'CARD_USAGE_BATCH'
  | 'TRANSFER_BATCH'
  | 'INTEREST_REGISTER';

interface AutomationDetail {
  itemId: string;
  status: 'SUCCESS' | 'FAILURE' | 'SKIPPED';
  message?: string;
  processedData?: any;
}

interface AutomationError {
  itemId?: string;
  errorCode: string;
  errorMessage: string;
  stackTrace?: string;
}
```

---

## 9. 화면 셀렉터 매핑

### 9.1 집행마감 화면 (94001)
```typescript
const ExecutionClosureSelectors = {
  // 조회 조건
  fiscalYear: '#fiscalYear',
  projectSelect: '#projectCode',
  searchButton: 'button[contains(text(), "조회")]',

  // 보조사업 정보 테이블
  projectInfoTable: '.project-info-table',
  settlementStatus: '.settlement-status',

  // 버튼
  interestRegisterBtn: 'button[contains(text(), "이자등록")]',
  revenueRegisterBtn: 'button[contains(text(), "수익금등록")]',
  closureBtn: 'button[contains(text(), "집행마감")]',
  closureCancelBtn: 'button[contains(text(), "집행마감취소")]',
};
```

### 9.2 집행이체관리 화면 (93003)
```typescript
const TransferManagementSelectors = {
  // 이체 구분 탭
  toVendorTab: '.tab[data-type="vendor"]',
  toSelfFundTab: '.tab[data-type="selffund"]',
  toSubsidyTab: '.tab[data-type="subsidy"]',

  // 이체 목록
  transferList: '.transfer-list',
  selectAllCheckbox: '.select-all',

  // 인증
  passwordInput: '#transferPassword',
  certificateBtn: 'button[contains(text(), "인증서 인증")]',
  transferBtn: 'button[contains(text(), "이체")]',
};
```

---

## 10. 데이터 검증 규칙

### 10.1 금액 검증
```typescript
const AmountValidation = {
  // 집행금액 = 공급가액 + 부가세액
  executionAmountCheck: (supply: Amount, vat: Amount, total: Amount) =>
    supply + vat === total,

  // 재원별 합계 = 총 집행금액
  fundingTotalCheck: (sources: FundingSource[], total: Amount) =>
    sources.reduce((sum, s) => sum + s.executionAmount, 0) === total,

  // 반환금액 = 잔액 + 불인정 + 이자 + 수익금
  returnAmountCheck: (details: ReturnDetail[], expected: Amount) =>
    details.reduce((sum, d) => sum + d.returnAmount, 0) === expected,
};
```

### 10.2 상태 검증
```typescript
const StatusValidation = {
  // 집행마감 가능 조건
  canCloseExecution: (project: SubsidyProject, pending: any) =>
    pending.registrationCount === 0 &&
    pending.requestCount === 0 &&
    pending.grantInProgress === 'N',

  // 정산반환 가능 조건
  canRequestReturn: (project: SubsidyProject) =>
    project.settlementStatus === '정산마감' &&
    project.performanceReportStatus === '승인',
};
```

---

**작성 완료일**: 2025-11-30
**버전**: 1.0
