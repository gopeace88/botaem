# ë³´íƒ¬e ìë™í™” ì‹œë‚˜ë¦¬ì˜¤ ìƒì„¸ ì„¤ê³„

## ê°œìš”
- **ì‘ì„±ì¼**: 2025-11-30
- **ëŒ€ìƒ ì‹œë‚˜ë¦¬ì˜¤**: 1~3ìˆœìœ„ ìë™í™” ëŒ€ìƒ
- **ê¸°ìˆ  ìŠ¤íƒ**: Python + Playwright

---

## ì‹œë‚˜ë¦¬ì˜¤ 1: ì „ìì„¸ê¸ˆê³„ì‚°ì„œ ì§‘í–‰ë“±ë¡ ìë™í™”

### 1.1 ì‹œë‚˜ë¦¬ì˜¤ ê°œìš”

| í•­ëª© | ë‚´ìš© |
|------|------|
| í™”ë©´ | ì§‘í–‰ë“±ë¡ (ì „ìì„¸ê¸ˆê³„ì‚°ì„œ) |
| ì‹¤í–‰ ì£¼ê¸° | ì¼ 1íšŒ (ì—…ë¬´ì‹œê°„ í›„) |
| ì˜ˆìƒ ì²˜ë¦¬ëŸ‰ | ì¼ 10~50ê±´ |
| ìë™í™” ìˆ˜ì¤€ | ì™„ì „ ìë™í™” |

### 1.2 ì‚¬ì „ ì¡°ê±´
```
âœ… ë³´íƒ¬e ë¡œê·¸ì¸ ì™„ë£Œ
âœ… ë³´ì¡°ì‚¬ì—… ì„ íƒ ì™„ë£Œ
âœ… í™ˆíƒìŠ¤ ì „ìì„¸ê¸ˆê³„ì‚°ì„œ ë°œí–‰ ì™„ë£Œ
âœ… ë¹„ëª©/ì„¸ëª© ë§¤í•‘ ê·œì¹™ ì„¤ì • ì™„ë£Œ
```

### 1.3 ìƒì„¸ í”Œë¡œìš°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ì „ìì„¸ê¸ˆê³„ì‚°ì„œ ì§‘í–‰ë“±ë¡ ìë™í™”                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚  [START]                                                            â”‚
â”‚     â”‚                                                               â”‚
â”‚     â–¼                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                â”‚
â”‚  â”‚ 1. ë¡œê·¸ì¸       â”‚                                                â”‚
â”‚  â”‚    ë³´íƒ¬e ì ‘ì†   â”‚                                                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                â”‚
â”‚           â”‚                                                         â”‚
â”‚           â–¼                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                â”‚
â”‚  â”‚ 2. ì‚¬ì—… ì„ íƒ    â”‚                                                â”‚
â”‚  â”‚    íšŒê³„ì—°ë„     â”‚                                                â”‚
â”‚  â”‚    ë³´ì¡°ì‚¬ì—…ì½”ë“œ â”‚                                                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                â”‚
â”‚           â”‚                                                         â”‚
â”‚           â–¼                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                â”‚
â”‚  â”‚ 3. ì§‘í–‰ë“±ë¡     â”‚                                                â”‚
â”‚  â”‚    í™”ë©´ ì´ë™    â”‚                                                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                â”‚
â”‚           â”‚                                                         â”‚
â”‚           â–¼                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                       â”‚
â”‚  â”‚ 4. ì „ìì„¸ê¸ˆ     â”‚â”€â”€â”€â”€â–¶â”‚ í™ˆíƒìŠ¤ ì—°ë™     â”‚                       â”‚
â”‚  â”‚    ê³„ì‚°ì„œ ì¡°íšŒ  â”‚     â”‚ ë°ì´í„° ë¡œë”©     â”‚                       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â”‚
â”‚           â”‚                                                         â”‚
â”‚           â–¼                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                â”‚
â”‚  â”‚ 5. ë¯¸ë“±ë¡ ê±´    â”‚                                                â”‚
â”‚  â”‚    í•„í„°ë§       â”‚                                                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                â”‚
â”‚           â”‚                                                         â”‚
â”‚           â–¼                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                       â”‚
â”‚  â”‚ 6. ê° ê±´ë³„ ì²˜ë¦¬ (LOOP)                   â”‚                       â”‚
â”‚  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚                       â”‚
â”‚  â”‚   â”‚ 6.1 ì„¸ê¸ˆê³„ì‚°ì„œ ì„ íƒ               â”‚ â”‚                       â”‚
â”‚  â”‚   â”‚ 6.2 ê±°ë˜ì²˜ ì •ë³´ í™•ì¸/ìë™ì…ë ¥     â”‚ â”‚                       â”‚
â”‚  â”‚   â”‚ 6.3 ë¹„ëª©/ì„¸ëª© ìë™ ë§¤í•‘           â”‚ â”‚                       â”‚
â”‚  â”‚   â”‚ 6.4 ê¸ˆì•¡ ê²€ì¦                     â”‚ â”‚                       â”‚
â”‚  â”‚   â”‚ 6.5 ì €ì¥                          â”‚ â”‚                       â”‚
â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚                       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â”‚
â”‚           â”‚                                                         â”‚
â”‚           â–¼                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                â”‚
â”‚  â”‚ 7. ì¼ê´„ ì§‘í–‰    â”‚                                                â”‚
â”‚  â”‚    ìš”ì²­         â”‚                                                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                â”‚
â”‚           â”‚                                                         â”‚
â”‚           â–¼                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                â”‚
â”‚  â”‚ 8. ê²°ê³¼ ë¡œê¹…    â”‚                                                â”‚
â”‚  â”‚    ë° ì•Œë¦¼      â”‚                                                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                â”‚
â”‚           â”‚                                                         â”‚
â”‚           â–¼                                                         â”‚
â”‚  [END]                                                              â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.4 ë‹¨ê³„ë³„ ìƒì„¸

#### Step 1: ë¡œê·¸ì¸
```python
async def login(page, credentials):
    """ë³´íƒ¬e ë¡œê·¸ì¸"""
    await page.goto('https://botame.kr/login')  # ì‹¤ì œ URLë¡œ ë³€ê²½
    await page.fill('#userId', credentials['user_id'])
    await page.fill('#password', credentials['password'])
    await page.click('button[type="submit"]')
    await page.wait_for_selector('.main-dashboard')
```

#### Step 2: ì‚¬ì—… ì„ íƒ
```python
async def select_project(page, fiscal_year, project_code):
    """ë³´ì¡°ì‚¬ì—… ì„ íƒ"""
    await page.select_option('#fiscalYear', fiscal_year)
    await page.fill('#projectCode', project_code)
    await page.click('button.search')
    await page.wait_for_selector('.project-info')
```

#### Step 3-4: ì „ìì„¸ê¸ˆê³„ì‚°ì„œ ì¡°íšŒ
```python
async def fetch_tax_invoices(page):
    """ë¯¸ë“±ë¡ ì „ìì„¸ê¸ˆê³„ì‚°ì„œ ì¡°íšŒ"""
    # ì§‘í–‰ë“±ë¡ ë©”ë‰´ ì´ë™
    await page.click('a[href*="execution"]')
    await page.click('a[href*="tax-invoice"]')

    # ì „ìì„¸ê¸ˆê³„ì‚°ì„œ ì¡°íšŒ ë²„íŠ¼ í´ë¦­
    await page.click('button.fetch-tax-invoice')

    # í™ˆíƒìŠ¤ ì—°ë™ ë°ì´í„° ë¡œë”© ëŒ€ê¸°
    await page.wait_for_selector('.tax-invoice-list')

    # ë¯¸ë“±ë¡ ê±´ë§Œ í•„í„°ë§
    invoices = await page.query_selector_all('.invoice-item:not(.registered)')
    return invoices
```

#### Step 5-6: ê±´ë³„ ì²˜ë¦¬
```python
async def process_invoice(page, invoice, mapping_rules):
    """ê°œë³„ ì„¸ê¸ˆê³„ì‚°ì„œ ì²˜ë¦¬"""
    # ì„¸ê¸ˆê³„ì‚°ì„œ ì„ íƒ
    await invoice.click()

    # ê±°ë˜ì²˜ ì •ë³´ ìë™ ë¡œë”© í™•ì¸
    vendor_name = await page.inner_text('.vendor-name')
    business_number = await page.inner_text('.business-number')

    # ë¹„ëª©/ì„¸ëª© ìë™ ë§¤í•‘
    budget_item = find_budget_item(vendor_name, mapping_rules)
    await page.select_option('#budgetItem', budget_item['item'])
    await page.select_option('#fundingType', budget_item['funding'])

    # ê¸ˆì•¡ ê²€ì¦
    supply = await get_amount(page, '#supplyAmount')
    vat = await get_amount(page, '#vatAmount')
    total = await get_amount(page, '#totalAmount')

    if supply + vat != total:
        raise ValidationError(f"ê¸ˆì•¡ ë¶ˆì¼ì¹˜: {supply} + {vat} != {total}")

    # ì €ì¥
    await page.click('button.save')
    await page.wait_for_selector('.save-success')
```

#### Step 7: ì¼ê´„ ì§‘í–‰ìš”ì²­
```python
async def batch_execution_request(page):
    """ì €ì¥ëœ ê±´ ì¼ê´„ ì§‘í–‰ìš”ì²­"""
    # ì „ì²´ ì„ íƒ
    await page.click('.select-all')

    # ì§‘í–‰ìš”ì²­ ë²„íŠ¼ í´ë¦­
    await page.click('button.execution-request')

    # í™•ì¸ ë‹¤ì´ì–¼ë¡œê·¸
    await page.click('button.confirm')

    # ì™„ë£Œ ëŒ€ê¸°
    await page.wait_for_selector('.request-complete')
```

### 1.5 ë¹„ëª©/ì„¸ëª© ë§¤í•‘ ê·œì¹™ ì˜ˆì‹œ
```python
BUDGET_MAPPING_RULES = [
    {
        'vendor_type': 'ìŒì‹ì ',
        'budget_item': 'íšŒì˜ë¹„',
        'funding_type': 'ì‹œë„ë¹„'
    },
    {
        'vendor_type': 'ì‚¬ë¬´ìš©í’ˆ',
        'budget_item': 'ì‚¬ë¬´ìš©í’ˆë¹„',
        'funding_type': 'ì‹œë„ë¹„'
    },
    {
        'vendor_name_contains': 'ì¸ì‡„',
        'budget_item': 'ì¸ì‡„ë¹„',
        'funding_type': 'ì‹œë„ë¹„'
    },
    {
        'default': True,
        'budget_item': 'ê¸°íƒ€ìš´ì˜ë¹„',
        'funding_type': 'ì‹œë„ë¹„'
    }
]
```

### 1.6 ì˜¤ë¥˜ ì²˜ë¦¬
```python
class TaxInvoiceAutomation:
    async def run(self):
        results = []
        errors = []

        try:
            await self.login()
            await self.select_project()
            invoices = await self.fetch_tax_invoices()

            for invoice in invoices:
                try:
                    result = await self.process_invoice(invoice)
                    results.append(result)
                except ValidationError as e:
                    errors.append({
                        'invoice_id': invoice.id,
                        'error': str(e),
                        'action': 'SKIPPED'
                    })
                except Exception as e:
                    errors.append({
                        'invoice_id': invoice.id,
                        'error': str(e),
                        'action': 'FAILED'
                    })

            if results:
                await self.batch_execution_request()

        finally:
            await self.generate_report(results, errors)
            await self.send_notification(results, errors)
```

---

## ì‹œë‚˜ë¦¬ì˜¤ 2: ì¹´ë“œì‚¬ìš©ë‚´ì—­ ì§‘í–‰ë“±ë¡ ìë™í™”

### 2.1 ì‹œë‚˜ë¦¬ì˜¤ ê°œìš”

| í•­ëª© | ë‚´ìš© |
|------|------|
| í™”ë©´ | ë³´ì¡°ê¸ˆì „ìš©ì¹´ë“œ ì‚¬ìš©ë‚´ì—­ê´€ë¦¬ (97003), ì§‘í–‰ë“±ë¡ |
| ì‹¤í–‰ ì£¼ê¸° | ì¼ 1íšŒ (ì˜¤ì „, ì•¼ê°„ ë°°ì¹˜ í›„) |
| ì˜ˆìƒ ì²˜ë¦¬ëŸ‰ | ì¼ 5~20ê±´ |
| ìë™í™” ìˆ˜ì¤€ | ì™„ì „ ìë™í™” |

### 2.2 ì‚¬ì „ ì¡°ê±´
```
âœ… ë³´íƒ¬e ë¡œê·¸ì¸ ì™„ë£Œ
âœ… ë³´ì¡°ì‚¬ì—… ì„ íƒ ì™„ë£Œ
âœ… ì „ìš©ì¹´ë“œ ë“±ë¡ ì™„ë£Œ
âœ… ì¹´ë“œì‚¬ ì•¼ê°„ ë°°ì¹˜ ì™„ë£Œ (D+1)
âœ… ë¹„ëª©/ì„¸ëª© ë§¤í•‘ ê·œì¹™ ì„¤ì • ì™„ë£Œ
```

### 2.3 ìƒì„¸ í”Œë¡œìš°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ì¹´ë“œì‚¬ìš©ë‚´ì—­ ì§‘í–‰ë“±ë¡ ìë™í™”                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚  [START]                                                            â”‚
â”‚     â”‚                                                               â”‚
â”‚     â–¼                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                â”‚
â”‚  â”‚ 1. ë¡œê·¸ì¸       â”‚                                                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                â”‚
â”‚           â”‚                                                         â”‚
â”‚           â–¼                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                â”‚
â”‚  â”‚ 2. ì¹´ë“œì‚¬ìš©     â”‚                                                â”‚
â”‚  â”‚    ë‚´ì—­ê´€ë¦¬     â”‚                                                â”‚
â”‚  â”‚    í™”ë©´ ì´ë™    â”‚                                                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                â”‚
â”‚           â”‚                                                         â”‚
â”‚           â–¼                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                â”‚
â”‚  â”‚ 3. ë¯¸ì‚¬ìš© ë‚´ì—­  â”‚                                                â”‚
â”‚  â”‚    ì¡°íšŒ         â”‚                                                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                â”‚
â”‚           â”‚                                                         â”‚
â”‚           â–¼                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                       â”‚
â”‚  â”‚ 4. ê° ê±´ë³„ ì²˜ë¦¬ (LOOP)                   â”‚                       â”‚
â”‚  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚                       â”‚
â”‚  â”‚   â”‚ 4.1 ì¹´ë“œë‚´ì—­ ì„ íƒ                 â”‚ â”‚                       â”‚
â”‚  â”‚   â”‚ 4.2 ì§‘í–‰ë“±ë¡ í™”ë©´ ì´ë™            â”‚ â”‚                       â”‚
â”‚  â”‚   â”‚ 4.3 ì¦ë¹™ìœ í˜• "ì‹ ìš©ì¹´ë“œ" ì„ íƒ      â”‚ â”‚                       â”‚
â”‚  â”‚   â”‚ 4.4 ë¹„ëª©/ì„¸ëª© ìë™ ë§¤í•‘           â”‚ â”‚                       â”‚
â”‚  â”‚   â”‚ 4.5 ì €ì¥                          â”‚ â”‚                       â”‚
â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚                       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â”‚
â”‚           â”‚                                                         â”‚
â”‚           â–¼                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                â”‚
â”‚  â”‚ 5. ì¼ê´„ ì§‘í–‰    â”‚                                                â”‚
â”‚  â”‚    ìš”ì²­         â”‚                                                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                â”‚
â”‚           â”‚                                                         â”‚
â”‚           â–¼                                                         â”‚
â”‚  [END]                                                              â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.4 ë‹¨ê³„ë³„ ì½”ë“œ

```python
class CardUsageAutomation:

    async def fetch_unused_card_records(self, page):
        """ë¯¸ì‚¬ìš© ì¹´ë“œë‚´ì—­ ì¡°íšŒ"""
        # ì¹´ë“œì‚¬ìš©ë‚´ì—­ê´€ë¦¬ í™”ë©´ ì´ë™
        await page.click('a[href*="card-usage"]')

        # ì¡°íšŒ ì¡°ê±´ ì„¤ì •
        await page.select_option('#fiscalYear', self.fiscal_year)
        await page.fill('#projectCode', self.project_code)

        # ë¯¸ì‚¬ìš© ë‚´ì—­ë§Œ í•„í„°
        await page.check('#unusedOnly')

        # ì¡°íšŒ
        await page.click('button.search')
        await page.wait_for_selector('.card-usage-list')

        # ë¯¸ì‚¬ìš© ë‚´ì—­ ì¶”ì¶œ
        records = await page.query_selector_all('.card-usage-item[data-used="false"]')
        return records

    async def process_card_usage(self, page, record):
        """ê°œë³„ ì¹´ë“œë‚´ì—­ ì§‘í–‰ë“±ë¡"""
        # ì¹´ë“œë‚´ì—­ ë°ì´í„° ì¶”ì¶œ
        merchant_name = await record.inner_text('.merchant-name')
        business_type = await record.inner_text('.business-type')
        amount = await record.inner_text('.amount')

        # ì§‘í–‰ë“±ë¡ ë²„íŠ¼ í´ë¦­
        await record.click('button.register-execution')

        # ì§‘í–‰ë“±ë¡ íŒì—…/í™”ë©´ ëŒ€ê¸°
        await page.wait_for_selector('.execution-form')

        # ì¦ë¹™ìœ í˜• ì„ íƒ
        await page.select_option('#evidenceType', 'ì‹ ìš©ì¹´ë“œ')

        # ë¹„ëª©/ì„¸ëª© ìë™ ë§¤í•‘
        budget = self.find_budget_mapping(merchant_name, business_type)
        await page.select_option('#budgetItem', budget['item'])
        await page.select_option('#fundingType', budget['funding'])

        # ì €ì¥
        await page.click('button.save')
        await page.wait_for_selector('.save-success')

        return {
            'merchant': merchant_name,
            'amount': amount,
            'budget_item': budget['item'],
            'status': 'SUCCESS'
        }
```

---

## ì‹œë‚˜ë¦¬ì˜¤ 3: ì§‘í–‰ì´ì²´ ì¼ê´„ì²˜ë¦¬ (ë°˜ìë™)

### 3.1 ì‹œë‚˜ë¦¬ì˜¤ ê°œìš”

| í•­ëª© | ë‚´ìš© |
|------|------|
| í™”ë©´ | ì§‘í–‰ì´ì²´ê´€ë¦¬ (93003) |
| ì‹¤í–‰ ì£¼ê¸° | ì¼ 1íšŒ (ì§€ì • ì‹œê°„) |
| ì˜ˆìƒ ì²˜ë¦¬ëŸ‰ | ì¼ 5~30ê±´ |
| ìë™í™” ìˆ˜ì¤€ | **ë°˜ìë™í™”** (ì¸ì¦ì„œ ì¸ì¦ë§Œ ìˆ˜ë™) |

### 3.2 ë°˜ìë™í™” ì‚¬ìœ 
```
âš ï¸ ê³µë™ì¸ì¦ì„œ ë¹„ë°€ë²ˆí˜¸ ì…ë ¥ í•„ìš”
âš ï¸ ë³´ì•ˆìƒ ì¸ì¦ì„œ ë¹„ë°€ë²ˆí˜¸ ìë™í™” ë¶ˆê°€
âš ï¸ ê¸ˆìœµ ì´ì²´ íŠ¹ì„±ìƒ ì‚¬ëŒ í™•ì¸ ê¶Œì¥
```

### 3.3 ìƒì„¸ í”Œë¡œìš°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ì§‘í–‰ì´ì²´ ì¼ê´„ì²˜ë¦¬ (ë°˜ìë™)                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚  [ìë™í™” ì˜ì—­]                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ 1. ë¡œê·¸ì¸                                                    â”‚   â”‚
â”‚  â”‚ 2. ì§‘í–‰ì´ì²´ê´€ë¦¬ í™”ë©´ ì´ë™                                     â”‚   â”‚
â”‚  â”‚ 3. ì´ì²´ëŒ€ìƒ ì¡°íšŒ (ë¯¸ìš”ì²­ ê±´)                                  â”‚   â”‚
â”‚  â”‚ 4. ì „ì²´ ì„ íƒ                                                 â”‚   â”‚
â”‚  â”‚ 5. ì´ì²´ë¹„ë°€ë²ˆí˜¸ ì…ë ¥ (ì„¤ì •ê°’ ì‚¬ìš©)                            â”‚   â”‚
â”‚  â”‚ 6. ì´ì²´ ë²„íŠ¼ í´ë¦­                                            â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                            â”‚                                        â”‚
â”‚                            â–¼                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ ğŸ’¡ ì•Œë¦¼: "ì¸ì¦ì„œ ì¸ì¦ì´ í•„ìš”í•©ë‹ˆë‹¤"                           â”‚   â”‚
â”‚  â”‚    - ì´ì²´ ê±´ìˆ˜: XXê±´                                         â”‚   â”‚
â”‚  â”‚    - ì´ì²´ ê¸ˆì•¡: XX,XXX,XXXì›                                 â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                            â”‚                                        â”‚
â”‚                            â–¼                                        â”‚
â”‚  [ìˆ˜ë™ ì˜ì—­]                                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ 7. ì¸ì¦ì„œ ì„ íƒ (ìˆ˜ë™)                                        â”‚   â”‚
â”‚  â”‚ 8. ì¸ì¦ì„œ ë¹„ë°€ë²ˆí˜¸ ì…ë ¥ (ìˆ˜ë™)                                â”‚   â”‚
â”‚  â”‚ 9. í™•ì¸ ë²„íŠ¼ í´ë¦­ (ìˆ˜ë™)                                     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                            â”‚                                        â”‚
â”‚                            â–¼                                        â”‚
â”‚  [ìë™í™” ì˜ì—­]                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ 10. ì´ì²´ ê²°ê³¼ í™•ì¸                                           â”‚   â”‚
â”‚  â”‚ 11. ê²°ê³¼ ë¡œê¹…                                                â”‚   â”‚
â”‚  â”‚ 12. ì™„ë£Œ ì•Œë¦¼                                                â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.4 ì½”ë“œ êµ¬í˜„

```python
class TransferAutomation:

    async def prepare_transfer(self, page):
        """ì´ì²´ ì¤€ë¹„ (ìë™í™” ì˜ì—­)"""
        # ì§‘í–‰ì´ì²´ê´€ë¦¬ í™”ë©´ ì´ë™
        await page.click('a[href*="transfer-management"]')
        await page.wait_for_selector('.transfer-list')

        # ë¯¸ìš”ì²­ ê±´ ì¡°íšŒ
        await page.select_option('#transferStatus', 'ë¯¸ìš”ì²­')
        await page.click('button.search')

        # ì´ì²´ ëŒ€ìƒ í™•ì¸
        items = await page.query_selector_all('.transfer-item')
        if not items:
            return {'status': 'NO_ITEMS', 'count': 0}

        # ì „ì²´ ì„ íƒ
        await page.click('.select-all')

        # ì´ì²´ ê¸ˆì•¡ í•©ê³„ ê³„ì‚°
        total_amount = await self.calculate_total_amount(page)

        # ì´ì²´ë¹„ë°€ë²ˆí˜¸ ì…ë ¥
        await page.fill('#transferPassword', self.transfer_password)

        # ì´ì²´ ë²„íŠ¼ í´ë¦­
        await page.click('button.transfer')

        # ì¸ì¦ì„œ íŒì—… ëŒ€ê¸°
        await page.wait_for_selector('.certificate-popup')

        return {
            'status': 'WAITING_CERTIFICATE',
            'count': len(items),
            'total_amount': total_amount
        }

    async def notify_user(self, prepare_result):
        """ì‚¬ìš©ì ì•Œë¦¼"""
        message = f"""
        âš ï¸ ì¸ì¦ì„œ ì¸ì¦ì´ í•„ìš”í•©ë‹ˆë‹¤

        - ì´ì²´ ê±´ìˆ˜: {prepare_result['count']}ê±´
        - ì´ì²´ ê¸ˆì•¡: {prepare_result['total_amount']:,}ì›

        ë¸Œë¼ìš°ì €ì—ì„œ ì¸ì¦ì„œ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.
        """

        # Slack/ì´ë©”ì¼/SMS ì•Œë¦¼
        await self.send_notification(message)

    async def wait_for_completion(self, page, timeout=300):
        """ì´ì²´ ì™„ë£Œ ëŒ€ê¸° (ìˆ˜ë™ ì¸ì¦ í›„)"""
        try:
            # ì¸ì¦ ì™„ë£Œ ë° ì´ì²´ ê²°ê³¼ ëŒ€ê¸°
            await page.wait_for_selector(
                '.transfer-complete',
                timeout=timeout * 1000
            )

            # ê²°ê³¼ ìˆ˜ì§‘
            results = await self.collect_results(page)
            return results

        except TimeoutError:
            return {'status': 'TIMEOUT', 'message': 'ì¸ì¦ ëŒ€ê¸° ì‹œê°„ ì´ˆê³¼'}
```

---

## ê³µí†µ ìœ í‹¸ë¦¬í‹°

### ë¡œê¹… ë° ëª¨ë‹ˆí„°ë§
```python
import logging
from datetime import datetime

class AutomationLogger:
    def __init__(self, automation_type):
        self.logger = logging.getLogger(automation_type)
        self.execution_id = datetime.now().strftime('%Y%m%d%H%M%S')

    def log_start(self, params):
        self.logger.info(f"[{self.execution_id}] ìë™í™” ì‹œì‘: {params}")

    def log_item(self, item_id, status, message=None):
        self.logger.info(f"[{self.execution_id}] {item_id}: {status} - {message}")

    def log_end(self, summary):
        self.logger.info(f"[{self.execution_id}] ìë™í™” ì™„ë£Œ: {summary}")
```

### ì•Œë¦¼ ì„œë¹„ìŠ¤
```python
class NotificationService:
    async def send_slack(self, channel, message):
        # Slack ì›¹í›… ì „ì†¡
        pass

    async def send_email(self, to, subject, body):
        # ì´ë©”ì¼ ì „ì†¡
        pass

    async def send_summary(self, results):
        """ì‹¤í–‰ ê²°ê³¼ ìš”ì•½ ì•Œë¦¼"""
        summary = f"""
        ğŸ“Š ë³´íƒ¬e ìë™í™” ì‹¤í–‰ ê²°ê³¼

        âœ… ì„±ê³µ: {results['success_count']}ê±´
        âŒ ì‹¤íŒ¨: {results['failure_count']}ê±´
        â­ï¸ ìŠ¤í‚µ: {results['skipped_count']}ê±´

        ì²˜ë¦¬ ì‹œê°„: {results['duration']}ì´ˆ
        """
        await self.send_slack('#botame-automation', summary)
```

### ìŠ¤ì¼€ì¤„ëŸ¬ ì„¤ì •
```python
# cron ì„¤ì • ì˜ˆì‹œ

# ì „ìì„¸ê¸ˆê³„ì‚°ì„œ ìë™í™”: ë§¤ì¼ 18:00
0 18 * * * python /path/to/tax_invoice_automation.py

# ì¹´ë“œì‚¬ìš©ë‚´ì—­ ìë™í™”: ë§¤ì¼ 09:00 (ì•¼ê°„ ë°°ì¹˜ í›„)
0 9 * * * python /path/to/card_usage_automation.py

# ì§‘í–‰ì´ì²´ ì¤€ë¹„: ë§¤ì¼ 14:00 (ì¸ì¦ ëŒ€ê¸°)
0 14 * * * python /path/to/transfer_automation.py
```

---

## ì‹¤í–‰ í™˜ê²½ ì„¤ì •

### ì„¤ì • íŒŒì¼ (config.yaml)
```yaml
botame:
  url: "https://botame.kr"
  timeout: 30000

credentials:
  user_id: "${BOTAME_USER_ID}"
  password: "${BOTAME_PASSWORD}"
  transfer_password: "${BOTAME_TRANSFER_PASSWORD}"

project:
  fiscal_year: "2024"
  project_code: "20240000012345678"

automation:
  tax_invoice:
    enabled: true
    schedule: "0 18 * * *"
    max_items: 100

  card_usage:
    enabled: true
    schedule: "0 9 * * *"
    max_items: 50

  transfer:
    enabled: true
    schedule: "0 14 * * *"
    require_manual_auth: true

notification:
  slack:
    webhook_url: "${SLACK_WEBHOOK_URL}"
    channel: "#botame-automation"

  email:
    smtp_server: "smtp.example.com"
    recipients:
      - "admin@example.com"

logging:
  level: "INFO"
  file: "/var/log/botame/automation.log"
  rotation: "daily"
```

---

## í…ŒìŠ¤íŠ¸ ê³„íš

### ë‹¨ìœ„ í…ŒìŠ¤íŠ¸
```python
import pytest

class TestTaxInvoiceAutomation:

    def test_budget_mapping_default(self):
        """ê¸°ë³¸ ë¹„ëª© ë§¤í•‘ í…ŒìŠ¤íŠ¸"""
        result = find_budget_mapping("ì•Œìˆ˜ì—†ëŠ”ì—…ì²´", "ê¸°íƒ€")
        assert result['item'] == 'ê¸°íƒ€ìš´ì˜ë¹„'

    def test_budget_mapping_restaurant(self):
        """ìŒì‹ì  ë¹„ëª© ë§¤í•‘ í…ŒìŠ¤íŠ¸"""
        result = find_budget_mapping("OOì‹ë‹¹", "ìŒì‹ì ")
        assert result['item'] == 'íšŒì˜ë¹„'

    def test_amount_validation_success(self):
        """ê¸ˆì•¡ ê²€ì¦ ì„±ê³µ"""
        assert validate_amount(10000, 1000, 11000) == True

    def test_amount_validation_failure(self):
        """ê¸ˆì•¡ ê²€ì¦ ì‹¤íŒ¨"""
        assert validate_amount(10000, 1000, 12000) == False
```

### í†µí•© í…ŒìŠ¤íŠ¸
```python
class TestIntegration:

    @pytest.mark.asyncio
    async def test_full_flow_tax_invoice(self):
        """ì „ìì„¸ê¸ˆê³„ì‚°ì„œ ì „ì²´ í”Œë¡œìš° í…ŒìŠ¤íŠ¸"""
        # í…ŒìŠ¤íŠ¸ í™˜ê²½ì—ì„œ ì‹¤í–‰
        automation = TaxInvoiceAutomation(config='test')
        result = await automation.run()

        assert result['status'] == 'SUCCESS'
        assert result['error_count'] == 0
```

---

## ìš´ì˜ ê°€ì´ë“œ

### ì¼ì¼ ì ê²€ ì‚¬í•­
```
â–¡ ìë™í™” ì‹¤í–‰ ë¡œê·¸ í™•ì¸
â–¡ ì‹¤íŒ¨ ê±´ ì›ì¸ ë¶„ì„
â–¡ ë¹„ëª© ë§¤í•‘ ì˜¤ë¥˜ ê²€í† 
â–¡ ì´ì²´ ì™„ë£Œ ê±´ í™•ì¸
```

### ì¥ì•  ëŒ€ì‘
| ìƒí™© | ì›ì¸ | ëŒ€ì‘ |
|------|------|------|
| ë¡œê·¸ì¸ ì‹¤íŒ¨ | ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ | ì„¤ì • íŒŒì¼ ì—…ë°ì´íŠ¸ |
| ì…€ë ‰í„° ì˜¤ë¥˜ | í™”ë©´ ë³€ê²½ | ì…€ë ‰í„° ì¬ì„¤ì • |
| íƒ€ì„ì•„ì›ƒ | ì„œë²„ ì§€ì—° | timeout ê°’ ì¡°ì • |
| ì´ì²´ ì‹¤íŒ¨ | ì”ì•¡ ë¶€ì¡± | ìˆ˜ë™ í™•ì¸ í•„ìš” |

---

**ì‘ì„± ì™„ë£Œì¼**: 2025-11-30
**ë²„ì „**: 1.0
